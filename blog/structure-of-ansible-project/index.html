<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Structure of Ansible project | Jozo</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://jozo.io/blog/structure-of-ansible-project/">
<link rel="icon" href="../../assets/img/favicon.ico" sizes="16x16">
<link rel="icon" href="../../assets/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" href="../../assets/img/favicon-512x512.png" sizes="512x512">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Jozo Gaborik">
<link rel="prev" href="../books-i-have-read-in-2017/" title="Books I have read in 2017" type="text/html">
<link rel="next" href="../how-to-split-traffic-on-globalprotect-vpn-on-mac-os/" title="How to split traffic on GlobalProtect VPN on Mac OS" type="text/html">
<meta property="og:site_name" content="Jozo">
<meta property="og:title" content="Structure of Ansible project">
<meta property="og:url" content="https://jozo.io/blog/structure-of-ansible-project/">
<meta property="og:description" content="In my projects (including Spine Hero) I like to use Ansible. 
It's a great tool for deploying your code and for setup of whole enviroment on server.


With one command you can transform a plain linux ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-01-31T18:38:03+02:00">
<meta property="article:tag" content="ansible">
<meta property="article:tag" content="deployment">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
          <header id="header"><div class="inner">
        <h1 id="brand"><a href="../../" title="Jozo" rel="home">

      Jozo<span>blog</span>
  </a></h1>

      
        <nav id="menu"><ul>
<li><a href="../../archive.html">Archive</a></li>
          <li><a href="../../categories/">Tags</a></li>

      
      
      
      <li><a href="../rss.xml" title="RSS feed"><i class="fas fa-rss"></i></a></li>
    </ul></nav>
</div>
  </header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Structure of Ansible project</a></h1>

    <div class="metadata">
      <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                  Jozo Gaborik
            </span></p>
      <p class="dateline">
        <a href="." rel="bookmark">
          <time class="published dt-published" datetime="2017-01-31T18:38:03+02:00" itemprop="datePublished" title="2017-01-31 18:38">2017-01-31 18:38</time></a>
      </p>
        <p class="commentline">            <a href="#disqus_thread" data-disqus-identifier="cache/posts/2017-structure-of-ansible-project.html">Comments</a>


      </p>
<p><em>3 minutes of reading</em></p>
      
    </div>
    
  </header><div class="e-content entry-content" itemprop="articleBody text">
      <div>
<p>In my projects (including <a href="https://spinehero.com">Spine Hero</a>) I like to use Ansible. 
It's a great tool for deploying your code and for setup of whole enviroment on server.</p>
<!-- TEASER_END -->

<p>With one command you can transform a plain linux server into server 
that has installed newest nginx, gunicorn, postgresql etc. and your application
is running on it.</p>
<p>When you want all of that, you have to write playbooks. Ansible's playbooks are YAML files
which contain tasks. These tasks will setup your server. But when you have tens of tasks
you need to put them into seperates files to maintain readability and modularity.
Because sometimes you want just to deploy your code not to setup whole server, right?
How to do that?</p>
<h3>Structure of project</h3>
<p>This is how I organize files inside the root of my project that use Ansible:</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="#-1"><code data-line-number="1"></code></a></td>
<td class="code"><code>.
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-2"><code data-line-number="2"></code></a></td>
<td class="code"><code>├── ansible/
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-3"><code data-line-number="3"></code></a></td>
<td class="code"><code>├── src/
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-4"><code data-line-number="4"></code></a></td>
<td class="code"><code>├── .ansible-vault-password.txt
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-5"><code data-line-number="5"></code></a></td>
<td class="code"><code>├── ansible.cfg
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-6"><code data-line-number="6"></code></a></td>
<td class="code"><code>└── README.md
</code></td>
</tr>
</table></div>

<p>Source code is in <code>src/</code> directory and all Ansible related files are placed inside <code>ansible/</code>.
There are also two Ansible files in the root. First, <code>.ansible-vault-password.txt</code> store password
for Vault files. Vault enables Ansible to use variables from encrypted files. This is great
because you can safely push your encrypted files to git repository
(this also means you can't push .ansible-vault-password.txt to git). Second file, <code>ansible.cfg</code>,
is config file for Ansible. In my case it mostly says to Ansible to use <code>.ansible-vault-password.txt</code>
for decrypting files.</p>
<h3>Structure of Ansible files</h3>
<p>Inside of <code>ansible/</code> directory looks like this:</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code>ansible/
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code>├── group_vars
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code>│   ├── all.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code>│   ├── production
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code>│   │   ├── vars.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code>│   │   └── vault.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code>│   └── staging
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code>│       ├── vars.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code>│       └── vault.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code>├── roles
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code>│   ├── base
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code>│   │   └── tasks
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code>│   ├── server
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-14"><code data-line-number="14"></code></a></td>
<td class="code"><code>│   │   ├── handlers
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-15"><code data-line-number="15"></code></a></td>
<td class="code"><code>│   │   ├── tasks
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-16"><code data-line-number="16"></code></a></td>
<td class="code"><code>│   │   │   ├── main.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-17"><code data-line-number="17"></code></a></td>
<td class="code"><code>│   │   │   ├── setup_db.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-18"><code data-line-number="18"></code></a></td>
<td class="code"><code>│   │   │   ├── setup_gunicorn.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-19"><code data-line-number="19"></code></a></td>
<td class="code"><code>│   │   │   └── setup_nginx.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-20"><code data-line-number="20"></code></a></td>
<td class="code"><code>│   │   └── templates
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-21"><code data-line-number="21"></code></a></td>
<td class="code"><code>│   │       ├── gunicorn_start.j2
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-22"><code data-line-number="22"></code></a></td>
<td class="code"><code>│   │       └── nginx_site_config.j2
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-23"><code data-line-number="23"></code></a></td>
<td class="code"><code>│   └── web
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-24"><code data-line-number="24"></code></a></td>
<td class="code"><code>│       ├── tasks
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-25"><code data-line-number="25"></code></a></td>
<td class="code"><code>│       └── templates
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-26"><code data-line-number="26"></code></a></td>
<td class="code"><code>├── hosts_production
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-27"><code data-line-number="27"></code></a></td>
<td class="code"><code>├── hosts_vagrant
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-28"><code data-line-number="28"></code></a></td>
<td class="code"><code>├── production.yml
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="#-29"><code data-line-number="29"></code></a></td>
<td class="code"><code>└── vagrant.yml
</code></td>
</tr>
</table></div>

<h4>host files</h4>
<p><code>hosts_production, hosts_vagrant</code> - addresses of servers (can be IP) with login information</p>
<p><code>production.yml, vagrant.yml</code> - contain main task and variables</p>
<h4>group_vars</h4>
<p>This directory contains variables that are used in tasks. </p>
<p><code>all.yml</code> - General variables that are same on production and also staging - like application name, server name</p>
<p><code>production/vars.yml</code> - Variables that are specific for the enviroment - different paths, enable/disable debug mode, ssl</p>
<p><code>production/vault.yml</code> - encrypted file with variables like passwords to database and etc</p>
<h4>roles</h4>
<p>Inside of <code>roles/</code> directory are placed playbooks with tasks. They are grouped together into directories 
by purpose of task they contain.</p>
<p><code>base/</code> - Installation of general packages that are need to monitor and work on the server.</p>
<p><code>server/</code> - Every task you need to setup a web server. Installation of nginx, postgresql, memcached, etc.
Configurations for this tools are in <code>templates/</code> directory. Templates use variables from <code>group_vars</code> directory.</p>
<p><code>web</code> - Tasks focused on deploying a new version of your app, running migrations and things you need 
to achieve zero downtime.</p>
<h3>Provisioning with one command</h3>
<p>Now, when you have all of this you can deploy your app to a new server with one command:</p>
<div class="code"><table class="codetable"><tr>
<td class="linenos linenodiv"><a href="#-1"><code data-line-number="1"></code></a></td>
<td class="code"><code>ansible-playbook -i ansible/hosts_production ansible/production.yml
</code></td>
</tr></table></div>

<p><em>Do you have any questions? Write them in comments belove.</em></p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/ansible/" rel="tag">ansible</a></li>
            <li><a class="tag p-category" href="../../categories/deployment/" rel="tag">deployment</a></li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="jozo-io",
            disqus_url="https://jozo.io/blog/structure-of-ansible-project/",
        disqus_title="Structure of Ansible project",
        disqus_identifier="cache/posts/2017-structure-of-ansible-project.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


      </section></article><script>var disqus_shortname="jozo-io";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script></main><footer id="footer"><ul class="social">
<li><a href="http://github.com/jozo" target="_blank" title="Github"><i class="fab fa-github-alt"></i></a></li>
    <li><a href="http://gitlab.com/jozo" target="_blank" title="Gitlab"><i class="fab fa-gitlab"></i></a></li>
    <li><a href="https://stackoverflow.com/users/6634060/jozo" target="_blank" title="StackOverflow"><i class="fab fa-stack-overflow"></i></a></li>
    <li><a href="http://twitter.com/jozo_io" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a></li>
    <li><a href="https://mastodon.technology/@jozo" target="_blank" title="Mastodon"><i class="fab fa-mastodon"></i></a></li>
    <li>
<a href="http://linkedin.com/in/jozo" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
    </li>
  </ul>
<p><small>© 2020 <a href="mailto:hi@jozo.io">Jozo Gaborik</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> and ♥ <small></small></small></p>
      
    </footer>
</div>
          <script src="../../assets/js/all-nocdn.js"></script><script src="https://polyfill.io/v3/polyfill.js?features=Intl.RelativeTimeFormat.%7Elocale.en"></script><script src="../../assets/js/luxon.min.js"></script><script src="https://kit.fontawesome.com/8a0d4a7b33.js" crossorigin="anonymous"></script><!-- fancy dates --><script>
    luxon.Settings.defaultLocale = "en";
    fancydates(2, {"preset": false, "format": "yyyy-MM-dd HH:mm"});
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
